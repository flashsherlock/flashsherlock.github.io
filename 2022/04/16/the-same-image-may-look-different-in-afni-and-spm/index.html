<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.110.0"><title>The same image may look different in AFNI and SPM - Fei</title><meta property="og:title" content="The same image may look different in AFNI and SPM - Fei"><link href=https://flashsherlock.github.io/favicon.ico rel=icon type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-3WJ71TQ2TX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3WJ71TQ2TX",{anonymize_ip:!1})}</script><link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/atom-one-dark-reasonable.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/css/fonts.css media=all><link rel=stylesheet href=/css/main.css media=all></head><body><div class=wrapper><header class=header><nav class=nav><a href=/ class=nav-logo><img src=/images/logo.png width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/>Home</a></li><li><a href=http://zhouw.psych.ac.cn/>Lab</a></li><li><a href=https://github.com/flashsherlock/rwebsite>GitHub</a></li><li><a href=/about/>About</a></li></ul></nav></header><main class=content role=main><article class=article><h1 class=article-title>The same image may look different in AFNI and SPM</h1><span class=article-duration>2 min read</span>
<span class=article-date>2022-04-16</span><div class=article-content><script src=/rmarkdown-libs/header-attrs/header-attrs.js></script><div id=TOC><ul><li><a href=#introduction><span class=toc-section-number>1</span> Introduction</a></li><li><a href=#deal-with-obliquity><span class=toc-section-number>2</span> Deal with obliquity</a></li><li><a href=#references><span class=toc-section-number>3</span> References</a></li></ul></div><div id=introduction class="section level1" number=1><h1><span class=header-section-number>1</span> Introduction</h1><p>It is well known that coordinate systems adopted by different neuroimaging software are different. For example, AFNI uses <a href=https://sscc.nimh.nih.gov/afni/doc/faq/59#>RAI system</a> (-x = Right, -y = Anterior, -z = Inferior) by default while SPM uses LPI system. However, this could not explain why the same image may look different in AFNI and SPM (or MRIcron). Obliquity is probably the real reason.</p><p>AFNI and SPM (or MRIcron) interpret the coordinate system differently when the image is <a href=https://sscc.nimh.nih.gov/sscc/dglen/Obliquity>oblique</a>. More specifically, <a href=https://afni.nimh.nih.gov/afni/community/board/read.php?1,84182,84266#msg-84266>AFNI does not apply the oblique transformation</a> in the header while SPM does. This might cause unexpected results when transfer data from one software to the other.</p></div><div id=deal-with-obliquity class="section level1" number=2><h1><span class=header-section-number>2</span> Deal with obliquity</h1><p>To check whether the image is oblique, simply type <code>3dinfo</code> command.</p><pre class=bash><code># check whether the image is oblique
3dinfo –is_oblique img_name.nii 
# or just use `3dinfo img_name.nii`
# and look at Data Axes Tilt</code></pre><p>If you use MRIcron, you can look at the header information (Window -> Information), where non-zero quaternions indicate obliquity.</p><p><img src=/post/2022-04-16-the-same-image-may-look-different-in-afni-and-spm_files/orig.png style="width:95%;display:block;margin:0 auto"></p><p>Replacing the transformation matrix in header with cardinal matrix changes the data axes tilt from oblique to plumb. This can be achieved via <a href=https://afni.nimh.nih.gov/pub/dist/doc/htmldoc/programs/3drefit_sphx.html#ahelp-3drefit><code>3drefit</code></a> with the <code>-deoblique</code> option</p><pre class=bash><code># replace transformation matrix
3drefit –deoblique img_name.nii </code></pre><p>Then you will see that quaternions become zeros in the header information.</p><p><img src=/post/2022-04-16-the-same-image-may-look-different-in-afni-and-spm_files/refit.png style="width:95%;display:block;margin:0 auto"></p><p>As shown below (the crosshair indicates the origin), the deobliqued image looks same in AFNI and MRIcron. In addition, the deobliqued image looks the same as the original image in AFNI, because AFNI does not apply the oblique transformation.</p><p><img src=/post/2022-04-16-the-same-image-may-look-different-in-afni-and-spm_files/summary.png style="width:100%;display:block;margin:0 auto"></p><p>By the way, <code>3dresample</code> also replace the transformation matrix automatically with cardinal matrix as <code>3drefit -deoblique</code> does. However, this does not really deoblique the volume. To do so, you should use <a href=https://afni.nimh.nih.gov/pub/dist/doc/htmldoc/programs/3dWarp_sphx.html#ahelp-3dwarp><code>3dwarp</code></a> with <code>-deoblique</code> option.</p></div><div id=references class="section level1" number=3><h1><span class=header-section-number>3</span> References</h1><p>NIfTI header information:</p><ul><li><a href=https://afni.nimh.nih.gov/pub/dist/doc/nifti/nifti_revised.html>NIfTI-1 data format</a></li><li><a href=https://nifti.nimh.nih.gov/nifti-1/documentation/nifti1fields/nifti1fields_pages/figqformusage>qform</a></li><li><a href=https://nifti.nimh.nih.gov/nifti-1/documentation/nifti1fields/nifti1fields_pages/qsform_brief_usage#transforming>usage of qform and sform</a></li></ul><p>Other problems caused by obliquity:</p><ul><li><a href=https://afni.nimh.nih.gov/afni/community/board/read.php?1,142949,142988#msg-142988>Dealing with oblique datasets</a></li></ul></div></div></article><section id=comments><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(n=function(){var e=!0;try{e=window.self!==window.top}catch{}return e},n())return;var n,t=document,e=t.createElement("script");e.src="//gufei.disqus.com/embed.js",e.async=!0,e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></section></main><footer class=footer><ul class=footer-links><li><a href=/index.xml type=application/rss+xml target=_blank>RSS feed</a></li><li><a href=mailto:guf@psych.ac.cn>Email: guf@psych.ac.cn</a></li><li><a href=https://gohugo.io/ class=footer-links-kudos>Made with <img src=/images/hugo-logo.png alt="Img link to Hugo website" width=22 height=22></a></li></ul></footer></div><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/r.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/matlab.min.js></script>
<script>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad(),hljs.initLineNumbersOnLoad()</script></body></html>